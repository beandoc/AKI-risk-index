<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AKI Post-Discharge Toolkit - AKI Risk Index</title>
  <!-- No external Tailwind: All CSS is in the style block below -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    html, body {
      min-height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #eef2ff 0%, #fff 60%, #dbeafe 100%);
      color: #22223b;
    }
    #root {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .main-card {
      max-width: 600px;
      width: 98vw;
      background: rgba(255,255,255,0.92);
      border-radius: 2rem;
      box-shadow: 0 10px 32px 0 rgba(30,64,175,0.09), 0 1.5px 4px 0 rgba(30,64,175,0.09);
      border: 1px solid #e0e7ff;
      padding: 2.5rem 2.3rem 2.3rem 2.3rem;
      margin: 1.5rem 0;
      transition: box-shadow 0.2s;
    }
    .main-card:hover {
      box-shadow: 0 16px 40px 0 rgba(30,64,175,0.15), 0 3px 10px 0 rgba(30,64,175,0.10);
    }
    .app-title {
      font-size: 2.2rem;
      font-weight: 900;
      background: linear-gradient(90deg, #3730a3 15%, #10b981 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -1px;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .app-subtitle {
      font-size: 1.08rem;
      font-weight: 500;
      color: #3730a3;
      text-align: center;
      margin-bottom: 0.8rem;
    }
    .form-label {
      font-weight: 600;
      font-size: 0.97rem;
      margin-bottom: 0.2rem;
      color: #312e81;
      display:block;
    }
    .form-req {
      color: #be123c;
      margin-left: 3px;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1.4rem;
      margin-bottom: 1rem;
    }
    .form-col {
      flex: 1 1 220px;
      min-width: 180px;
      display: flex;
      flex-direction: column;
    }
    .input, select {
      padding: 0.7rem;
      border-radius: 0.7rem;
      border: 1.3px solid #c7d2fe;
      font-size: 1rem;
      color: #212a43;
      background: #f8fafc;
      outline: none;
      transition: border 0.2s;
      margin-bottom: 0.1rem;
    }
    .input:focus, select:focus {
      border: 1.3px solid #6366f1;
      background: #fff;
    }
    .input-unit {
      margin-left: 0.7rem;
      color: #818cf8;
      font-size: 0.93rem;
    }
    .calc-btn {
      margin-top: 0.7rem;
      width: 100%;
      background: linear-gradient(90deg, #6366f1 10%, #06b6d4 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1.12rem;
      padding: 0.9rem 0;
      border-radius: 0.9rem;
      border: none;
      box-shadow: 0 1px 8px 0 #dbeafe;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .calc-btn:hover, .calc-btn:focus {
      background: linear-gradient(90deg, #3730a3 10%, #16a34a 100%);
      box-shadow: 0 4px 18px 0 #a5b4fc;
    }
    .results-card {
      margin-top: 2.2rem;
      background: linear-gradient(120deg, #e0e7ff 60%, #f0fdf4 100%);
      border: 1.5px solid #6366f1;
      border-radius: 1.4rem;
      box-shadow: 0 3px 24px 0 rgba(30,64,175,0.12);
      padding: 2rem 1.3rem 1.2rem 1.3rem;
      text-align: center;
      animation: fade-in 0.75s cubic-bezier(.4,0,.2,1) both;
    }
    .result-label {
      font-size: 1.04rem;
      font-weight: 600;
      color: #312e81;
    }
    .result-value {
      display: block;
      font-size: 1.35rem;
      font-weight: 700;
      margin: 0.16rem 0 0.4rem 0;
      color: #0e7490;
      letter-spacing: 0.01em;
    }
    .result-badge {
      display: inline-block;
      background: linear-gradient(90deg,#6366f1,#06b6d4);
      color: #fff;
      border-radius: 9999px;
      padding: 0.31rem 1.1rem;
      font-size: 1.08rem;
      font-weight: 700;
      margin: 0.24rem 0;
      box-shadow: 0 1px 4px #c7d2fe;
      letter-spacing: 0.01em;
    }
    .result-score {
      color: #3730a3;
      background: #bfdbfe;
      border-radius: 0.6rem;
      padding: 0.13rem 0.8rem;
      font-size: 1.1rem;
      font-weight: 700;
      margin: 0.3rem 0;
      display: inline-block;
    }
    .result-note {
      margin-top: 1.3rem;
      color: #475569;
      font-size: 0.93rem;
      text-align: center;
      line-height: 1.6;
    }
    .footer {
      margin: 2.2rem 0 0.7rem 0;
      font-size: 0.96rem;
      text-align: center;
      color: #c7d2fe;
    }
    @keyframes fade-in { 0% { opacity: 0; transform: translateY(20px);} 100% { opacity: 1; transform: translateY(0);} }
    @media (max-width: 600px) {
      .main-card { padding: 1.1rem 0.6rem 1.5rem 0.6rem; }
      .app-title { font-size: 1.33rem;}
      .form-row { gap: 0.7rem;}
      .form-col { min-width: 120px; }
      .results-card { padding: 1.3rem 0.5rem 1rem 0.5rem;}
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.1.0",
        "react-dom": "https://esm.sh/react-dom@19.1.0"
      }
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    import React, { useState, useMemo, useCallback } from "react";
    import ReactDOM from "react-dom";

    // --- Constants ---
    const SEX_OPTIONS = [
      { value: '', label: 'Select Sex' },
      { value: 'Female', label: 'Female' },
      { value: 'Male', label: 'Male' },
    ];
    const ALBUMINURIA_OPTIONS = [
      { value: '', label: 'Select Albuminuria Level' },
      { value: 'Mild/None', label: 'Mild/None' },
      { value: 'Moderate', label: 'Moderate' },
      { value: 'Heavy', label: 'Heavy' },
    ];
    const IN_HOSPITAL_DIALYSIS_OPTIONS = [
      { value: 'No', label: 'No' },
      { value: 'Yes', label: 'Yes' },
    ];
    const AKI_STAGE_DISPLAY = {
      0: "No AKI / Stage 0 (Review inputs)",
      1: "Stage 1",
      2: "Stage 2",
      3: "Stage 3"
    };

    // --- UI Components ---
    function Input({ id, label, type, value, onChange, placeholder, unit, required, min, max, step }) {
      return (
        <div className="form-col">
          <label htmlFor={id} className="form-label">
            {label} {required && <span className="form-req">*</span>}
          </label>
          <div style={{display:"flex",alignItems:"center"}}>
            <input
              className="input"
              type={type}
              id={id}
              name={id}
              value={value === null ? '' : value}
              onChange={onChange}
              placeholder={placeholder}
              required={required}
              min={min}
              max={max}
              step={step}
              autoComplete="off"
            />
            {unit && <span className="input-unit">{unit}</span>}
          </div>
        </div>
      );
    }

    function Select({ id, label, value, onChange, options, required }) {
      return (
        <div className="form-col">
          <label htmlFor={id} className="form-label">
            {label} {required && <span className="form-req">*</span>}
          </label>
          <select
            className="input"
            id={id}
            name={id}
            value={value}
            onChange={onChange}
            required={required}
          >
            {options.map(option => (
              <option key={option.value} value={option.value} disabled={option.value === ''}>
                {option.label}
              </option>
            ))}
          </select>
        </div>
      );
    }

    function Button({ children, ...props }) {
      return (
        <button className="calc-btn" {...props}>
          {children}
        </button>
      );
    }

    // --- Risk Score Calculation Functions ---
    function getAgePoints(age) {
      if (age === null) return 0;
      if (age < 50) return 0;
      if (age <= 59) return 1;
      if (age <= 69) return 2;
      if (age <= 79) return 2;
      if (age <= 89) return 2;
      return 3;
    }
    function getSexPoints(sex) {
      if (sex === 'Female') return 3;
      return 0;
    }
    function getBaselineScrPoints(scr) {
      if (scr === null) return 0;
      if (scr < 0.6) return 0;
      if (scr < 0.7) return 1;
      if (scr < 0.8) return 1;
      if (scr < 0.9) return 2;
      if (scr < 1.0) return 2;
      if (scr < 1.1) return 3;
      if (scr < 1.2) return 3;
      if (scr < 1.3) return 4;
      return 5;
    }
    function getAlbuminuriaPoints(albuminuria) {
      switch (albuminuria) {
        case 'Mild/None': return 0;
        case 'Moderate': return 1;
        case 'Heavy': return 3;
        default: return 0;
      }
    }
    function getAkiStagePoints(akiStage) {
      if (akiStage === 0 || akiStage === 1) return 0;
      if (akiStage === 2) return 1;
      if (akiStage === 3) return 3;
      return 0;
    }
    function getDischargeScrPoints(scr) {
      if (scr === null) return 0;
      if (scr < 1.0) return 0;
      if (scr < 1.3) return 3;
      if (scr < 1.6) return 6;
      if (scr < 1.9) return 7;
      return 11;
    }
    function calculateTotalPointScore(patientData, akiStage) {
      let score = 0;
      score += getAgePoints(patientData.age);
      score += getSexPoints(patientData.sex);
      score += getBaselineScrPoints(patientData.baselineScr);
      score += getAlbuminuriaPoints(patientData.albuminuria);
      score += getAkiStagePoints(akiStage);
      score += getDischargeScrPoints(patientData.dischargeScr);
      return score;
    }
    function getRiskFromPointScore(score) {
      if (score <= 8) return 0.5;
      if (score <= 14) return 3.0;
      if (score <= 17) return 7.5;
      if (score === 18) return 13.04;
      if (score === 19) return 17.34;
      if (score === 20) return 22.7;
      if (score === 21) return 29.12;
      if (score === 22) return 36.5;
      if (score === 23) return 44.58;
      if (score === 24) return 52.8;
      if (score === 25) return 61.17;
      if (score === 26) return 67.0;
      if (score === 27) return 72.0;
      if (score >= 28) return 75.0;
      return 75.0;
    }

    // --- Main Calculator Form ---
    function RiskCalculatorForm({ onRiskCalculated }) {
      const [patientData, setPatientData] = useState({
        age: null,
        sex: '',
        albuminuria: '',
        inHospitalDialysis: false,
        baselineScr: null,
        peakScrInHospital: null,
        dischargeScr: null,
        dischargeDate: null,
      });
      const [calculatedAkiStage, setCalculatedAkiStage] = useState(null);
      const [calculatedRisk, setCalculatedRisk] = useState(null);
      const [totalPoints, setTotalPoints] = useState(null);
      const [showResult, setShowResult] = useState(false);

      const handleInputChange = useCallback((e) => {
        const { name, value, type } = e.target;
        setPatientData(prev => ({
          ...prev,
          [name]: type === 'number' ? (value === '' ? null : parseFloat(value)) : value,
        }));
        setShowResult(false);
      }, []);

      const handleSelectChange = useCallback((e) => {
        const { name, value } = e.target;
        setPatientData(prev => ({
          ...prev,
          [name]: value,
        }));
        setShowResult(false);
      }, []);

      const handleDialysisChange = useCallback((e) => {
        setPatientData(prev => ({
          ...prev,
          inHospitalDialysis: e.target.value === 'Yes',
        }));
        setShowResult(false);
      }, []);

      const calculateAkiStage = useMemo(() => {
        const { baselineScr, peakScrInHospital, inHospitalDialysis } = patientData;
        if (baselineScr === null || peakScrInHospital === null || baselineScr <= 0) return 0;
        const scrRatio = peakScrInHospital / baselineScr;
        const scrIncrease = peakScrInHospital - baselineScr;
        if (inHospitalDialysis) return 3;
        if (peakScrInHospital >= 4.0) return 3;
        if (scrRatio >= 3.0) return 3;
        if (scrRatio >= 2.0 && scrRatio < 3.0) return 2;
        if (scrIncrease >= 0.3 || (scrRatio >= 1.5 && scrRatio < 2.0)) return 1;
        return 0;
      }, [patientData]);

      function handleSubmit(e) {
        e.preventDefault();
        if (patientData.baselineScr !== null && (patientData.baselineScr < 0.28 || patientData.baselineScr > 1.82)) {
          alert("Baseline Serum Creatinine must be between 0.28 and 1.82 mg/dL.\n\nThis calculator is for those hospitalized with AKI and baseline eGFR > 45 mL/min/1.73 mÂ².");
          return;
        }
        if (!patientData.dischargeDate) {
          alert("Please enter the Hospital Discharge Date to generate a follow-up plan.");
          return;
        }
        const currentAkiStage = calculateAkiStage;
        setCalculatedAkiStage(currentAkiStage);
        const points = calculateTotalPointScore(patientData, currentAkiStage);
        setTotalPoints(points);
        const risk = getRiskFromPointScore(points);
        setCalculatedRisk(risk);
        onRiskCalculated(risk, points, patientData, currentAkiStage);
        setShowResult(true);
      }

      return (
        <form onSubmit={handleSubmit} autoComplete="off">
          <div className="form-row">
            <Input id="age" label="Age (years)" type="number" value={patientData.age ?? ''} onChange={handleInputChange} required min={0} />
            <Select id="sex" label="Sex" value={patientData.sex} onChange={handleSelectChange} options={SEX_OPTIONS} required />
          </div>
          <div className="form-row">
            <Input id="baselineScr" label="Baseline Serum Creatinine (0.28-1.82)" type="number" value={patientData.baselineScr ?? ''} onChange={handleInputChange} unit="mg/dL" required min={0.28} max={1.82} step={0.01} />
            <Input id="peakScrInHospital" label="Peak Serum Creatinine during hospital admission" type="number" value={patientData.peakScrInHospital ?? ''} onChange={handleInputChange} unit="mg/dL" required min={0.1} step={0.01} />
          </div>
          <div className="form-row">
            <Input id="dischargeScr" label="Discharge Serum Creatinine" type="number" value={patientData.dischargeScr ?? ''} onChange={handleInputChange} unit="mg/dL" required min={0.1} step={0.01} />
            <Select id="albuminuria" label="Albuminuria" value={patientData.albuminuria} onChange={handleSelectChange} options={ALBUMINURIA_OPTIONS} required />
          </div>
          <div className="form-row">
            <Input id="dischargeDate" label="Hospital Discharge Date" type="date" value={patientData.dischargeDate ?? ''} onChange={handleInputChange} required />
            <Select id="inHospitalDialysis" label="In-hospital dialysis initiated?" value={patientData.inHospitalDialysis ? 'Yes' : 'No'} onChange={handleDialysisChange} options={IN_HOSPITAL_DIALYSIS_OPTIONS} required />
          </div>
          <Button type="submit">Calculate Risk &amp; View Options</Button>
          {showResult && calculatedRisk !== null && calculatedAkiStage !== null && totalPoints !== null && (
            <div className="results-card">
              <h3 className="app-title" style={{fontSize:"1.4rem",marginBottom:"1.1rem"}}>Calculation Results</h3>
              <div className="result-label">Calculated AKI Stage:</div>
              <span className="result-badge">{AKI_STAGE_DISPLAY[calculatedAkiStage]}</span>
              <div style={{marginTop:"1.1rem"}} className="result-label">Total Risk Score:</div>
              <span className="result-score">{totalPoints} points</span>
              <div style={{marginTop:"1.1rem"}} className="result-label">Predicted Risk of Advanced CKD:</div>
              <span className="result-badge" style={{background:"linear-gradient(90deg,#10b981,#6366f1)"}}>{calculatedRisk.toFixed(2)}%</span>
              <div className="result-note">
                Note: This risk is calculated based on the point-score system published in James MT et al., JAMA 2017;318(18):1787-1797, Figure 3. It is an estimate and not a guarantee of future health outcome.
              </div>
            </div>
          )}
        </form>
      );
    }

    // --- Main App Component ---
    function App() {
      return (
        <div className="main-card">
          <div className="app-title">AKI Post-Discharge Toolkit</div>
          <div className="app-subtitle">AKI Risk Index Calculator</div>
          <RiskCalculatorForm onRiskCalculated={() => {}} />
          <div className="footer">
            &copy; {new Date().getFullYear()} AKI Risk Index | For educational use only.
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
